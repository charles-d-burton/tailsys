syntax = "proto3";
package tailsys;
option go_package = "./commands";

import "google/protobuf/timestamp.proto";

enum OSType {
  OS_TYPE_UNSPECIFIED = 0;
  LINUX = 1;
  MACOS = 2;
  WINDOWS = 3;
}

enum SystemType {
  COORDINATION_SERVER = 0;
  CLIENT = 1;
  CLI = 2;
}

message SysInfo {
  string hostname = 1;
  OSType type = 2;
  string ip = 3;
  google.protobuf.Timestamp lastSeen = 4;
}

message Key {
  string key = 1;
}

message NodeRegistrationRequest {
  SysInfo info = 1;
  Key key = 2;
  SystemType systemType = 3;
  bool accepted = 4;
}

message NodeRegistrationResponse {
  bool accepted = 1;
  Key key = 2;
}

service Registration {
  rpc Register(NodeRegistrationRequest) returns (NodeRegistrationResponse) {}
}

message PingRequest {
  google.protobuf.Timestamp ping = 1;
}

message PongResponse {
  google.protobuf.Timestamp ping = 1; 
  float inboundLatency = 2;
  Key key = 3;
}

service Pinger {
  rpc Ping(PingRequest) returns (PongResponse) {}
}

